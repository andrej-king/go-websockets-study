<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Repeated Messages Example</title>


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Roboto", serif;
        }

        #buttons {
            margin-bottom: 10px;

            button {
                cursor: pointer;
            }
        }
    </style>
</head>
<body>
<h1>WebSocket Repeated Messages Example</h1>

<div id="buttons">
    <button onclick="connect()">Start</button>
    <button onclick="disconnect()">Stop</button>
</div>

<p id="status-container">Status: <span id="status"></span></p>

<div id="data">Waiting for data...</div>

<script>
    let socket, div = null;
    const dataContainer = document.getElementById("data");
    const status = document.getElementById("status");

    window.addEventListener('load', function () {
        // Establish the initial connection
        connect();
    });

    function connect() {
        // Do nothing if socket already connected
        if (socket) {
            return;
        }

        if (window['WebSocket']) {
            // Create a WebSocket connection to the server
            socket = new WebSocket('ws://localhost:8080/ws');
        } else {
            alert("Not supporting websockets");
        }

        // Handle connection open event
        socket.onopen = function (event) {
            const statusMessage = 'Connected';
            const textStyleColor = 'green';

            // Create response msg div container
            div = document.createElement('div');
            div.style.color = textStyleColor;
            div.style.fontWeight = '500';
            div.appendChild(document.createTextNode(statusMessage));

            dataContainer.appendChild(div);

            // Update status container
            status.style.color = textStyleColor;
            status.textContent = statusMessage

            // Send an optional message to the server
            socket.send('Hello, server!');
        };

        // Handle incoming messages from the server
        socket.onmessage = function (event) {
            div = document.createElement('div');
            div.appendChild(document.createTextNode(event.data));

            dataContainer.appendChild(div);
        };

        // Handle connection close event
        socket.onclose = function (event) {
            const statusMessage = 'Disconnected';
            const textStyleColor = 'red';

            div = document.createElement('div');
            div.style.color = textStyleColor;
            div.style.fontWeight = '500';
            div.appendChild(document.createTextNode(statusMessage));

            dataContainer.appendChild(div);

            status.style.color = textStyleColor;
            status.textContent = statusMessage

            socket = null;
        };
    }

    function disconnect() {
        // Do nothing if no have socket
        if (!socket) {
            return;
        }

        socket.close();
    }
</script>
</body>
</html>
